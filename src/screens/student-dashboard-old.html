<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Estudiante - Sistema de Gesti√≥n</title>
    <link rel="stylesheet" href="../assets/dise√±os.css">
    <style>
        .student-badge {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            display: inline-block;
            margin-top: 10px;
        }

        .tasks-container {
            margin-top: 30px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .task-item {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .task-item:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .task-title {
            font-size: 18px;
            font-weight: 600;
            color: #002855;
        }

        .task-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-pendiente {
            background: #fef3c7;
            color: #92400e;
        }

        .status-completada {
            background: #d1fae5;
            color: #065f46;
        }

        .status-urgente {
            background: #fee2e2;
            color: #991b1b;
        }

        .task-description {
            color: #64748b;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .task-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #f1f5f9;
            font-size: 13px;
            color: #64748b;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #64748b;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        button {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            filter: brightness(1.1);
        }
        
        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1 id="userName">Bienvenido</h1>
        <div class="student-badge">üë®‚Äçüéì Estudiante</div>
        <p><strong>Sistema de Gesti√≥n de Tareas Escolares</strong></p>
        <button onclick="cerrarSesion()" style="margin-top: 10px; background: #e74c3c; color: white;">Cerrar Sesi√≥n</button>
    </header>

    <div class="section-title">Mis Tareas Pendientes</div>
    
    <!-- Contenedor de tareas - AQU√ç SE CARGAR√ÅN LAS TAREAS -->
    <div class="tasks-container" id="tasksContainer">
        <!-- Estado vac√≠o inicial -->
        <div class="empty-state" id="emptyState">
            <div class="empty-state-icon">üìö</div>
            <h3>Cargando tus tareas...</h3>
            <p>Por favor espera mientras cargamos tu informaci√≥n</p>
        </div>

        <!-- AQU√ç SE RENDERIZAR√ÅN LAS TAREAS DIN√ÅMICAMENTE -->
        <div id="tasksList" style="display: none;">
            <!-- Ejemplo de estructura de tarea (para referencia al implementar):
            <div class="task-item">
                <div class="task-header">
                    <div class="task-title">T√≠tulo de la tarea</div>
                    <span class="task-status status-pendiente">Pendiente</span>
                </div>
                <div class="task-description">Descripci√≥n de la tarea...</div>
                <div class="task-footer">
                    <span>üìÖ Fecha de entrega: DD/MM/YYYY</span>
                    <span>‚è∞ Tiempo restante: X d√≠as</span>
                </div>
            </div>
            -->
        </div>
    </div>

    <div class="section-title">Informaci√≥n Acad√©mica</div>
    <div class="data-list">
        <div class="data-item"><span class="label">üèõÔ∏è Instituci√≥n:</span> <span class="value">BUAP</span></div>
        <div class="data-item"><span class="label">üéì Carrera:</span> <span class="value" id="userCarrera">Cargando...</span></div>
        <div class="data-item"><span class="label">üÜî Matr√≠cula:</span> <span class="value" id="userMatricula">Cargando...</span></div>
    </div>

    <footer>
        Benem√©rita Universidad Aut√≥noma de Puebla | 2026
    </footer>
</div>

<script>
function getCookie(name) {
    return document.cookie.split('; ').find(row => row.startsWith(name + '='))?.split('=')[1];
}

function getStoredUser() {
    const savedLocal = localStorage.getItem('currentUser');
    if (savedLocal) return savedLocal;
    const savedCookie = getCookie('currentUser');
    return savedCookie ? decodeURIComponent(savedCookie) : null;
}

function clearSession() {
    localStorage.removeItem('currentUser');
    document.cookie = 'currentUser=; Max-Age=0; path=/; SameSite=Lax';
}

// Verificar autenticaci√≥n al cargar la p√°gina
window.addEventListener('DOMContentLoaded', () => {
    verificarSesion();
    // TODO: Llamar funci√≥n para cargar tareas
    // cargarTareasPendientes();
});

function verificarSesion() {
    const currentUserString = getStoredUser();
    console.log('verificarSesion - currentUser:', currentUserString);
    
    if (!currentUserString) {
        console.log('No hay usuario, redirigiendo a login');
        window.location.href = 'http://localhost:4200';
        return;
    }
    
    try {
        const user = JSON.parse(currentUserString);
        console.log('Usuario parseado:', user);
        
        // Verificar que sea estudiante
        if (user.rol !== 'estudiante') {
            console.log('Usuario no es estudiante, redirigiendo');
            window.location.href = 'http://localhost:4200';
            return;
        }
        
        const userNameElement = document.getElementById('userName');
        if (userNameElement) {
            userNameElement.textContent = `Bienvenido, ${user.nombre_completo}`;
        }
        
        const userCarreraElement = document.getElementById('userCarrera');
        if (userCarreraElement && user.carrera) {
            userCarreraElement.textContent = user.carrera;
        }

        const userMatriculaElement = document.getElementById('userMatricula');
        if (userMatriculaElement && user.id_usuario) {
            userMatriculaElement.textContent = user.id_usuario;
        }
    } catch (error) {
        console.error('Error al cargar usuario:', error);
        window.location.href = 'http://localhost:4200';
    }
}

// TODO: FUNCI√ìN PARA CARGAR TAREAS PENDIENTES DEL ESTUDIANTE
// async function cargarTareasPendientes() {
//     const currentUser = JSON.parse(localStorage.getItem('currentUser'));
//     const userId = currentUser.id_usuario;
//     
//     try {
//         const response = await fetch(`http://localhost:3000/api/tasks/user/${userId}`);
//         const tareas = await response.json();
//         
//         const emptyState = document.getElementById('emptyState');
//         const tasksList = document.getElementById('tasksList');
//         
//         if (tareas.length === 0) {
//             emptyState.innerHTML = `
//                 <div class="empty-state-icon">‚úÖ</div>
//                 <h3>¬°No tienes tareas pendientes!</h3>
//                 <p>Est√°s al d√≠a con todas tus asignaciones</p>
//             `;
//         } else {
//             emptyState.style.display = 'none';
//             tasksList.style.display = 'block';
//             
//             // Renderizar cada tarea
//             tasksList.innerHTML = tareas.map(tarea => `
//                 <div class="task-item">
//                     <div class="task-header">
//                         <div class="task-title">${tarea.titulo}</div>
//                         <span class="task-status status-${tarea.estado}">${tarea.estado}</span>
//                     </div>
//                     <div class="task-description">${tarea.descripcion}</div>
//                     <div class="task-footer">
//                         <span>üìÖ Fecha: ${new Date(tarea.fecha_entrega).toLocaleDateString('es-MX')}</span>
//                         <span>‚è∞ ${calcularTiempoRestante(tarea.fecha_entrega)}</span>
//                     </div>
//                 </div>
//             `).join('');
//         }
//     } catch (error) {
//         console.error('Error al cargar tareas:', error);
//         document.getElementById('emptyState').innerHTML = `
//             <div class="empty-state-icon">‚ö†Ô∏è</div>
//             <h3>Error al cargar tareas</h3>
//             <p>Intenta recargar la p√°gina</p>
//         `;
//     }
// }

// TODO: FUNCI√ìN AUXILIAR PARA CALCULAR TIEMPO RESTANTE
// function calcularTiempoRestante(fechaEntrega) {
//     const now = new Date();
//     const deadline = new Date(fechaEntrega);
//     const diff = deadline.getTime() - now.getTime();
//     const days = Math.floor(diff / (1000 * 60 * 60 * 24));
//     
//     if (days < 0) return '¬°Vencida!';
//     if (days === 0) return '¬°Hoy!';
//     if (days === 1) return 'Ma√±ana';
//     return `${days} d√≠as restantes`;
// }

function cerrarSesion() {
    clearSession();
    window.location.href = 'http://localhost:4200';
}
</script>

</body>
</html>
